{% for user in users %}
    <div class="user-item {% if user.active_conversation %}active{% endif %}" 
         onclick="startConversation('{{ user.id }}')">
        <div class="user-info">
            <div class="user-details">
                <div class="is-flex is-align-items-center mb-2">
                    <figure class="image is-48x48 mr-3" style="min-width: 48px;">
                        {% if user.foto_perfil %}
                            <img src="{{ user.foto_perfil }}" 
                                 class="is-rounded"
                                 alt="{{ user.username }}"
                                 style="object-fit: cover; width: 48px; height: 48px;">
                        {% else %}
                            <span class="has-background-link has-text-white is-flex is-justify-content-center is-align-items-center is-rounded" 
                                  style="width: 48px; height: 48px; font-weight: 600; font-size: 1.25rem;">
                                {{ user.username|first|upper }}
                            </span>
                        {% endif %}
                    </figure>
                    <div style="min-width: 0;">
                        <p class="has-text-weight-semibold mb-0">{{ user.username }}</p>
                        {% if user.nivel_permissao %}
                            <p class="is-size-7 has-text-grey">{{ user.get_nivel_permissao_display }}</p>
                        {% endif %}
                    </div>
                </div>
                
                {% if user.last_message %}
                    <div class="last-message-preview">
                        {{ user.last_message.content|truncatechars:40 }}
                    </div>
                {% else %}
                    <div class="last-message-preview has-text-grey-dark">
                        Clique para iniciar conversa
                    </div>
                {% endif %}
            </div>
            
            <div class="user-status">
                {% if user.unread_count > 0 %}
                    <span class="unread-badge">{{ user.unread_count }}</span>
                {% endif %}
            </div>
        </div>
    </div>
{% empty %}
    <div class="has-text-centered p-5 has-text-grey">
        <span class="icon is-large">
            <i class="fas fa-users fa-2x"></i>
        </span>
        <p class="mt-3">Nenhum usuário disponível</p>
    </div>
{% endfor %}